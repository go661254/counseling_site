# カウンセリング予約システム 基本設計書

## 1. システム構成

### 1.1 全体構成
```
[ブラウザ] ←→ [Flaskアプリケーション] ←→ [SQLiteデータベース]
```

### 1.2 使用技術
- バックエンド: Python 3.13 + Flask
- データベース: SQLite3
- フロントエンド: HTML5 + CSS3
- 開発環境: Visual Studio Code

## 2. 機能詳細設計

### 2.1 予約機能
#### 2.1.1 予約フォーム入力（/）
- HTTPメソッド: GET, POST
- 処理概要:
  1. フォーム表示（GET）
  2. 入力値の受け取り（POST）
  3. バリデーションチェック
  4. 確認画面へリダイレクト
- バリデーション項目:
  - 名前: 必須, 50文字以内
  - 日付: 必須, 今日以降
  - 時間: 必須, HH:MM形式

#### 2.1.2 予約確認（/confirm）
- HTTPメソッド: POST
- 処理概要:
  1. フォームデータの受け取り
  2. 重複予約チェック
  3. 確認画面表示
- 重複チェック:
  - 同じ日時の予約がないことを確認

#### 2.1.3 予約完了（/complete）
- HTTPメソッド: POST
- 処理概要:
  1. データベースへの保存
  2. 完了画面表示

### 2.2 予約管理機能
#### 2.2.1 予約一覧表示（/list）
- HTTPメソッド: GET
- 処理概要:
  1. データベースから予約情報取得
  2. 日時順にソート
  3. 一覧表示

#### 2.2.2 予約キャンセル（/delete/<id>）
- HTTPメソッド: GET
- 処理概要:
  1. 指定IDの予約を削除
  2. 一覧画面へリダイレクト

## 3. データベース設計

### 3.1 テーブル定義
#### reservations テーブル
| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 予約ID |
| name | TEXT | NOT NULL | 予約者名 |
| date | TEXT | NOT NULL | 予約日(YYYY-MM-DD) |
| time | TEXT | NOT NULL | 予約時間(HH:MM) |

### 3.2 インデックス
- date, time の複合インデックス（重複チェックの効率化）

## 4. 画面遷移設計

```
トップページ（/）
    ↓ [予約入力]
確認画面（/confirm）
    ↓ [確定] 
完了画面（/complete）
    ↓ [戻る]
トップページ（/）

予約一覧（/list）
    ↓ [キャンセル]
予約一覧（/list）
```

## 5. 画面レイアウト設計

### 5.1 共通要素
- ヘッダー: タイトル表示
- フォント: システムフォント
- 基本色: 
  - 背景: 白
  - 文字: 黒
  - アクセント: 青系

### 5.2 各画面レイアウト
#### 予約フォーム（/）
```
+------------------+
|     ヘッダー     |
+------------------+
| [名前入力欄]     |
| [日付選択]       |
| [時間選択]       |
| [確認ボタン]     |
+------------------+
```

#### 確認画面（/confirm）
```
+------------------+
|     ヘッダー     |
+------------------+
| 予約内容確認     |
| 名前: xxx        |
| 日時: xxx        |
| [確定][戻る]     |
+------------------+
```

#### 予約一覧（/list）
```
+------------------+
|     ヘッダー     |
+------------------+
| 予約一覧         |
| - 予約1 [キャンセル]|
| - 予約2 [キャンセル]|
| ...              |
+------------------+
```

## 6. セキュリティ設計

### 6.1 入力値の検証
- SQLインジェクション対策
  - プリペアドステートメントの使用
  - パラメータのバインド
- XSS対策
  - HTMLエスケープ処理
- CSRF対策
  - トークンの発行と検証

### 6.2 エラー処理
- データベースエラー
  - トランザクション制御
  - エラーログの記録
- バリデーションエラー
  - エラーメッセージの日本語表示

## 7. 運用設計

### 7.1 バックアップ
- データベースファイルの定期バックアップ

### 7.2 ログ
- アクセスログ
- エラーログ
- 予約操作ログ

## 8. テスト計画

### 8.1 単体テスト
- 各関数の入力値検証
- データベース操作の検証

### 8.2 結合テスト
- 画面遷移の検証
- データの整合性確認

### 8.3 システムテスト
- ブラウザ互換性確認
- レスポンス時間計測
